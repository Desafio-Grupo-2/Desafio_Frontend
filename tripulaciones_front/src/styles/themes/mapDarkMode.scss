/* Modo oscuro específico para el mapa */
.map-dark-mode {
  /* Variables de colores para modo oscuro del mapa - más claro */
  --map-bg-primary: #334155;
  --map-bg-secondary: #475569;
  --map-bg-tertiary: #64748b;
  --map-text-primary: #f8fafc;
  --map-text-secondary: #cbd5e1;
  --map-text-muted: #94a3b8;
  --map-border-color: #94a3b8;
  --map-shadow-color: rgba(0, 0, 0, 0.2);
  --map-accent-orange: #d97706;
  --map-accent-orange-muted: #92400e;
  --map-accent-blue: #3b82f6;

  /* Aplicar colores específicos del mapa */
  .map-container {
    background-color: var(--map-bg-primary);
  }

  /* Estilos mejorados para tiles oscuros del mapa - más claro */
  .dark-map-tiles {
    filter: invert(1) hue-rotate(200deg) brightness(1.1) contrast(0.9) saturate(1.4) sepia(0.2);
  }

  /* Aplicar filtro a todos los tiles de Leaflet - más claro */
  .leaflet-tile-pane {
    filter: invert(1) hue-rotate(200deg) brightness(1.1) contrast(0.9) saturate(1.4) sepia(0.2);
  }

  /* Controles del mapa en modo oscuro */
  .leaflet-control-container {
    .leaflet-control-zoom a {
      background-color: var(--map-bg-secondary);
      color: var(--map-text-primary);
      border-color: var(--map-border-color);
    }

    .leaflet-control-layers {
      background-color: var(--map-bg-secondary);
      color: var(--map-text-primary);
      border-color: var(--map-border-color);
    }
  }

  /* Popups del mapa en modo oscuro */
  .leaflet-popup-content-wrapper {
    background-color: var(--map-bg-secondary);
    color: var(--map-text-primary);
    border: 1px solid var(--map-border-color);
  }

  .leaflet-popup-tip {
    background-color: var(--map-bg-secondary);
  }

  /* Marcadores personalizados en modo oscuro */
  .custom-marker {
    filter: brightness(0.8) contrast(1.1);
  }

  /* Sidebar del mapa en modo oscuro */
  .transport-map-wrapper .sidebar {
    background: var(--map-bg-secondary) !important;
    color: var(--map-text-primary) !important;
    border-right: 1px solid var(--map-border-color) !important;

    /* 1. MEJORAR CONTRASTE DEL TÍTULO "Paradas Programadas" */
    h1, h2, h3 {
      color: #ffffff !important;
      font-weight: 700 !important;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
    }

    /* Botones naranjas más apagados */
    .tracking-btn {
      background: var(--map-accent-orange) !important;
      border: 1px solid var(--map-accent-orange) !important;
      color: #ffffff !important;
      box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3) !important;

      &:hover {
        background: var(--map-accent-orange-muted) !important;
        border-color: var(--map-accent-orange-muted) !important;
        box-shadow: 0 6px 16px rgba(217, 119, 6, 0.4) !important;
      }
    }

    .close-btn, .dismiss-btn {
      background: var(--map-accent-orange) !important;
      border: 1px solid var(--map-accent-orange) !important;
      color: #ffffff !important;
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3) !important;

      &:hover {
        background: var(--map-accent-orange-muted) !important;
        border-color: var(--map-accent-orange-muted) !important;
        box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4) !important;
      }
    }

    /* Botón del sidebar con el mismo naranja apagado */
    .sidebar-toggle-btn,
    .menu-toggle-btn,
    .hamburger-btn {
      background: var(--map-accent-orange) !important;
      border: 1px solid var(--map-accent-orange) !important;
      color: #ffffff !important;
      box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3) !important;

      &:hover {
        background: var(--map-accent-orange-muted) !important;
        border-color: var(--map-accent-orange-muted) !important;
        box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4) !important;
      }

      svg {
        color: #ffffff !important;
      }
    }

    /* Botón "ir a mi ubicación" - icono blanco */
    .location-btn,
    .my-location-btn,
    .center-location-btn,
    .locate-btn,
    button[title*="ubicación"],
    button[title*="location"],
    button[aria-label*="ubicación"],
    button[aria-label*="location"] {
      svg, 
      .icon,
      path,
      circle,
      line {
        color: #ffffff !important;
        fill: #ffffff !important;
        stroke: #ffffff !important;
      }
    }

    p {
      color: var(--map-text-secondary) !important;
    }

    .stats .stat-card {
      background: var(--map-bg-primary) !important;
      color: var(--map-text-primary) !important;
      border: 1px solid var(--map-border-color) !important;

      svg {
        color: var(--map-text-secondary) !important;
      }
    }

    .controls {
      .control-button {
        background: var(--map-bg-primary) !important;
        color: var(--map-text-primary) !important;
        border: 1px solid var(--map-border-color) !important;

        &:hover {
          background: var(--map-bg-tertiary) !important;
          color: var(--map-text-primary) !important;
        }

        &.active {
          background: var(--map-accent-orange) !important;
          color: white !important;
        }
      }
    }

    .route-info {
      background: var(--map-bg-primary) !important;
      color: var(--map-text-primary) !important;
      border: 1px solid var(--map-border-color) !important;

      .route-title {
        color: var(--map-text-primary) !important;
      }

      .route-details {
        color: var(--map-text-secondary) !important;
      }
    }

    /* 2. MEJORAR CONTRASTE DE LOS NOMBRES DE PARADAS */
    .stops-list {
      .stops {
        .stop-card {
          background: #1e293b !important;
          border: 1px solid #475569 !important;
          color: #ffffff !important;

          .stop-name {
            color: #ffffff !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
          }

          /* 3. MEJORAR CONTRASTE DE LAS DURACIONES - MÁS CLARAS */
          .stop-duration {
            color: #f1f5f9 !important;
            font-weight: 600 !important;
            font-size: 0.85rem !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
          }

          .stop-index {
            background: var(--map-accent-orange-muted) !important;
            color: #ffffff !important;
            border: 2px solid var(--map-accent-orange-muted) !important;
            font-weight: 700 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
          }

          &.completed {
            .stop-index {
              background: #059669 !important;
              border-color: #059669 !important;
              color: #ffffff !important;
            }
          }

          &.active {
            .stop-index {
              background: var(--map-accent-orange) !important;
              border-color: var(--map-accent-orange) !important;
              color: #ffffff !important;
            }
          }
        }
      }
    }
  }

  /* Div informativo del responsive en modo oscuro */
  .mobile-stats-card {
    background: var(--map-bg-secondary) !important;
    color: var(--map-text-primary) !important;
    border: 1px solid var(--map-border-color) !important;
    box-shadow: 0 8px 24px var(--map-shadow-color) !important;
    backdrop-filter: blur(10px) !important;

    .msc-header {
      .msc-title {
        color: var(--map-text-primary) !important;
        font-weight: 600 !important;
      }

      .msc-subtitle {
        color: var(--map-text-secondary) !important;
        font-weight: 400 !important;
      }
    }

    .msc-progress {
      .msc-progress-label {
        color: var(--map-text-secondary) !important;
        font-weight: 500 !important;
      }

      .msc-progress-bar {
        background: var(--map-bg-primary) !important;
        border: 1px solid var(--map-border-color) !important;
        border-radius: 8px !important;
        overflow: hidden !important;

        .msc-progress-fill {
          background: linear-gradient(90deg, var(--map-accent-orange), #f97316) !important;
          border-radius: 6px !important;
          box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3) !important;
        }
      }

      .msc-progress-text {
        color: var(--map-text-primary) !important;
        font-weight: 600 !important;
      }
    }

    .msc-stats {
      .msc-stat {
        background: var(--map-bg-primary) !important;
        border: 1px solid var(--map-border-color) !important;
        border-radius: 8px !important;
        padding: 8px 12px !important;

        .msc-stat-value {
          color: var(--map-text-primary) !important;
          font-weight: 700 !important;
        }

        .msc-stat-label {
          color: var(--map-text-secondary) !important;
          font-weight: 500 !important;
        }

        svg {
          color: var(--map-accent-orange) !important;
        }
      }
    }

    .msc-meta {
      .msc-meta-item {
        color: var(--map-text-muted) !important;
        font-weight: 400 !important;

        svg {
          color: var(--map-text-muted) !important;
        }
      }
    }
  }

  /* Botones flotantes en modo oscuro */
  .floating-icons {
    .floating-icon {
      background: var(--map-bg-secondary) !important;
      border: 1px solid var(--map-border-color) !important;
      color: var(--map-text-primary) !important;
      box-shadow: 0 6px 20px var(--map-shadow-color) !important;
      backdrop-filter: blur(10px) !important;
      transition: all 0.3s ease !important;

      &:hover {
        background: var(--map-bg-tertiary) !important;
        color: var(--map-text-primary) !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 25px var(--map-shadow-color) !important;
      }

      &:active {
        transform: translateY(0) !important;
        box-shadow: 0 4px 15px var(--map-shadow-color) !important;
      }

      &.active {
        background: var(--map-accent-orange) !important;
        color: white !important;
        border-color: var(--map-accent-orange) !important;
        box-shadow: 0 6px 20px rgba(217, 119, 6, 0.3) !important;

        &:hover {
          background: var(--map-accent-orange) !important;
          transform: translateY(-2px) !important;
          box-shadow: 0 8px 25px rgba(217, 119, 6, 0.4) !important;
        }
      }

      svg {
        color: inherit !important;
        transition: color 0.3s ease !important;
      }
    }
  }

  /* Mejoras adicionales para el modo oscuro */
  .transport-map-wrapper {
    background: var(--map-bg-primary) !important;

    .map-area {
      background: var(--map-bg-primary) !important;
    }

    /* Botones naranjas generales más apagados */
    button[class*="orange"], 
    .btn-orange,
    .button-orange,
    button[style*="background: #f97316"],
    button[style*="background: #ff6a3d"] {
      background: var(--map-accent-orange) !important;
      border-color: var(--map-accent-orange) !important;
      color: #ffffff !important;
      box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3) !important;

      &:hover {
        background: var(--map-accent-orange-muted) !important;
        border-color: var(--map-accent-orange-muted) !important;
        box-shadow: 0 6px 16px rgba(217, 119, 6, 0.4) !important;
      }
    }

    /* Iconos de ubicación en blanco - selectores más específicos */
    .leaflet-control-locate a,
    .leaflet-control-locate button,
    .floating-icon[title*="ubicación"],
    .floating-icon[title*="location"],
    .floating-icon svg,
    .floating-icon circle,
    .floating-icon path {
      color: #ffffff !important;
      fill: #ffffff !important;
      stroke: #ffffff !important;
    }
  }

  /* Estilos para elementos de texto en el mapa */
  .leaflet-control-attribution {
    background: var(--map-bg-secondary) !important;
    color: var(--map-text-secondary) !important;
    border: 1px solid var(--map-border-color) !important;
    border-radius: 4px !important;
  }

  /* Mejorar contraste de marcadores */
  .leaflet-marker-icon {
    filter: brightness(1.1) contrast(1.1) !important;
  }
}
